(function(b){var a=(typeof self=="object"&&self.self===self&&self)||(typeof global=="object"&&global.global===global&&global);if(typeof define==="function"&&define.amd){define(["underscore","jquery","exports"],function(g,h,e){a.Backbone=b(a,e,g,h)})}else{if(typeof exports!=="undefined"){var c=require("underscore"),d;try{d=require("jquery")}catch(f){}b(a,exports,c,d)}else{a.Backbone=b(a,{},a._,(a.jQuery||a.Zepto||a.ender||a.$))}}})(function(w,D,P,C){var H=w.Backbone;var n=Array.prototype.slice;D.VERSION="1.3.3";D.$=C;D.noConflict=function(){w.Backbone=H;return this};D.emulateHTTP=false;D.emulateJSON=false;var I=function(R,S,Q){switch(R){case 1:return function(){return P[S](this[Q])};case 2:return function(T){return P[S](this[Q],T)};case 3:return function(U,T){return P[S](this[Q],F(U,this),T)};case 4:return function(U,V,T){return P[S](this[Q],F(U,this),V,T)};default:return function(){var T=n.call(arguments);T.unshift(this[Q]);return P[S].apply(P,T)}}};var s=function(R,Q,S){P.each(Q,function(T,U){if(P[U]){R.prototype[U]=I(T,U,S)}})};var F=function(R,Q){if(P.isFunction(R)){return R}if(P.isObject(R)&&!Q._isModel(R)){return q(R)}if(P.isString(R)){return function(S){return S.get(R)}}return R};var q=function(Q){var R=P.matches(Q);return function(S){return R(S.attributes)}};var N=D.Events={};var y=/\s+/;var z=function(V,S,Q,W,T){var R=0,U;if(Q&&typeof Q==="object"){if(W!==void 0&&"context" in T&&T.context===void 0){T.context=W}for(U=P.keys(Q);R<U.length;R++){S=z(V,S,U[R],Q[U[R]],T)}}else{if(Q&&y.test(Q)){for(U=Q.split(y);R<U.length;R++){S=V(S,U[R],W,T)}}else{S=V(S,Q,W,T)}}return S};N.on=function(Q,S,R){return h(this,Q,S,R)};var h=function(U,Q,V,S,R){U._events=z(B,U._events||{},Q,V,{context:S,ctx:U,listening:R});if(R){var T=U._listeners||(U._listeners={});T[R.id]=R}return U};N.listenTo=function(U,R,W){if(!U){return this}var V=U._listenId||(U._listenId=P.uniqueId("l"));var T=this._listeningTo||(this._listeningTo={});var S=T[V];if(!S){var Q=this._listenId||(this._listenId=P.uniqueId("l"));S=T[V]={obj:U,objId:V,id:Q,listeningTo:T,count:0}}h(U,R,W,this,S);return this};var B=function(W,T,X,S){if(X){var R=W[T]||(W[T]=[]);var V=S.context,Q=S.ctx,U=S.listening;if(U){U.count++}R.push({callback:X,context:V,ctx:V||Q,listening:U})}return W};N.off=function(Q,S,R){if(!this._events){return this}this._events=z(d,this._events,Q,S,{context:R,listeners:this._listeners});return this};N.stopListening=function(V,Q,W){var T=this._listeningTo;if(!T){return this}var U=V?[V._listenId]:P.keys(T);for(var S=0;S<U.length;S++){var R=T[U[S]];if(!R){break}R.obj.off(Q,W,this)}return this};var d=function(ac,R,aa,ad){if(!ac){return}var W=0,X;var S=ad.context,Z=ad.listeners;if(!R&&!aa&&!S){var Q=P.keys(Z);for(;W<Q.length;W++){X=Z[Q[W]];delete Z[X.id];delete X.listeningTo[X.objId]}return}var Y=R?[R]:P.keys(ac);for(;W<Y.length;W++){R=Y[W];var T=ac[R];if(!T){break}var U=[];for(var V=0;V<T.length;V++){var ab=T[V];if(aa&&aa!==ab.callback&&aa!==ab.callback._callback||S&&S!==ab.context){U.push(ab)}else{X=ab.listening;if(X&&--X.count===0){delete Z[X.id];delete X.listeningTo[X.objId]}}}if(U.length){ac[R]=U}else{delete ac[R]}}return ac};N.once=function(Q,T,S){var R=z(G,{},Q,T,P.bind(this.off,this));if(typeof Q==="string"&&S==null){T=void 0}return this.on(R,T,S)};N.listenToOnce=function(S,Q,T){var R=z(G,{},Q,T,P.bind(this.stopListening,this,S));return this.listenTo(S,R)};var G=function(T,Q,U,S){if(U){var R=T[Q]=P.once(function(){S(Q,R);U.apply(this,arguments)});R._callback=U}return T};N.trigger=function(R){if(!this._events){return this}var T=Math.max(0,arguments.length-1);var Q=Array(T);for(var S=0;S<T;S++){Q[S]=arguments[S+1]}z(m,this._events,R,void 0,Q);return this};var m=function(Q,T,V,S){if(Q){var U=Q[T];var R=Q.all;if(U&&R){R=R.slice()}if(U){b(U,S)}if(R){b(R,[T].concat(S))}}return Q};var b=function(V,T){var W,U=-1,S=V.length,R=T[0],Q=T[1],X=T[2];switch(T.length){case 0:while(++U<S){(W=V[U]).callback.call(W.ctx)}return;case 1:while(++U<S){(W=V[U]).callback.call(W.ctx,R)}return;case 2:while(++U<S){(W=V[U]).callback.call(W.ctx,R,Q)}return;case 3:while(++U<S){(W=V[U]).callback.call(W.ctx,R,Q,X)}return;default:while(++U<S){(W=V[U]).callback.apply(W.ctx,T)}return}};N.bind=N.on;N.unbind=N.off;P.extend(D,N);var J=D.Model=function(Q,S){var R=Q||{};S||(S={});this.cid=P.uniqueId(this.cidPrefix);this.attributes={};if(S.collection){this.collection=S.collection}if(S.parse){R=this.parse(R,S)||{}}var T=P.result(this,"defaults");R=P.defaults(P.extend({},T,R),T);this.set(R,S);this.changed={};this.initialize.apply(this,arguments)};P.extend(J.prototype,N,{changed:null,validationError:null,idAttribute:"id",cidPrefix:"c",initialize:function(){},toJSON:function(Q){return P.clone(this.attributes)},sync:function(){return D.sync.apply(this,arguments)},get:function(Q){return this.attributes[Q]},escape:function(Q){return P.escape(this.get(Q))},has:function(Q){return this.get(Q)!=null},matches:function(Q){return !!P.iteratee(Q,this)(this.attributes)},set:function(Y,Q,ac){if(Y==null){return this}var Z;if(typeof Y==="object"){Z=Y;ac=Q}else{(Z={})[Y]=Q}ac||(ac={});if(!this._validate(Z,ac)){return false}var aa=ac.unset;var W=ac.silent;var X=[];var ab=this._changing;this._changing=true;if(!ab){this._previousAttributes=P.clone(this.attributes);this.changed={}}var V=this.attributes;var T=this.changed;var R=this._previousAttributes;for(var U in Z){Q=Z[U];if(!P.isEqual(V[U],Q)){X.push(U)}if(!P.isEqual(R[U],Q)){T[U]=Q}else{delete T[U]}aa?delete V[U]:V[U]=Q}if(this.idAttribute in Z){this.id=this.get(this.idAttribute)}if(!W){if(X.length){this._pending=ac}for(var S=0;S<X.length;S++){this.trigger("change:"+X[S],this,V[X[S]],ac)}}if(ab){return this}if(!W){while(this._pending){ac=this._pending;this._pending=false;this.trigger("change",this,ac)}}this._pending=false;this._changing=false;return this},unset:function(Q,R){return this.set(Q,void 0,P.extend({},R,{unset:true}))},clear:function(R){var Q={};for(var S in this.attributes){Q[S]=void 0}return this.set(Q,P.extend({},R,{unset:true}))},hasChanged:function(Q){if(Q==null){return !P.isEmpty(this.changed)}return P.has(this.changed,Q)},changedAttributes:function(S){if(!S){return this.hasChanged()?P.clone(this.changed):false}var R=this._changing?this._previousAttributes:this.attributes;var U={};for(var Q in S){var T=S[Q];if(P.isEqual(R[Q],T)){continue}U[Q]=T}return P.size(U)?U:false},previous:function(Q){if(Q==null||!this._previousAttributes){return null}return this._previousAttributes[Q]},previousAttributes:function(){return P.clone(this._previousAttributes)},fetch:function(R){R=P.extend({parse:true},R);var Q=this;var S=R.success;R.success=function(U){var T=R.parse?Q.parse(U,R):U;if(!Q.set(T,R)){return false}if(S){S.call(R.context,Q,U,R)}Q.trigger("sync",Q,U,R)};M(this,R);return this.sync("read",this,R)},save:function(V,R,Z){var W;if(V==null||typeof V==="object"){W=V;Z=R}else{(W={})[V]=R}Z=P.extend({validate:true,parse:true},Z);var T=Z.wait;if(W&&!T){if(!this.set(W,Z)){return false}}else{if(!this._validate(W,Z)){return false}}var U=this;var X=Z.success;var S=this.attributes;Z.success=function(ab){U.attributes=S;var aa=Z.parse?U.parse(ab,Z):ab;if(T){aa=P.extend({},W,aa)}if(aa&&!U.set(aa,Z)){return false}if(X){X.call(Z.context,U,ab,Z)}U.trigger("sync",U,ab,Z)};M(this,Z);if(W&&T){this.attributes=P.extend({},S,W)}var Q=this.isNew()?"create":(Z.patch?"patch":"update");if(Q==="patch"&&!Z.attrs){Z.attrs=W}var Y=this.sync(Q,this,Z);this.attributes=S;return Y},destroy:function(R){R=R?P.clone(R):{};var Q=this;var V=R.success;var T=R.wait;var S=function(){Q.stopListening();Q.trigger("destroy",Q,Q.collection,R)};R.success=function(W){if(T){S()}if(V){V.call(R.context,Q,W,R)}if(!Q.isNew()){Q.trigger("sync",Q,W,R)}};var U=false;if(this.isNew()){P.defer(R.success)}else{M(this,R);U=this.sync("delete",this,R)}if(!T){S()}return U},url:function(){var Q=P.result(this,"urlRoot")||P.result(this.collection,"url")||t();if(this.isNew()){return Q}var R=this.get(this.idAttribute);return Q.replace(/[^\/]$/,"$&/")+encodeURIComponent(R)},parse:function(R,Q){return R},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return !this.has(this.idAttribute)},isValid:function(Q){return this._validate({},P.extend({},Q,{validate:true}))},_validate:function(S,R){if(!R.validate||!this.validate){return true}S=P.extend({},this.attributes,S);var Q=this.validationError=this.validate(S,R)||null;if(!Q){return true}this.trigger("invalid",this,Q,P.extend(R,{validationError:Q}));return false}});var a={keys:1,values:1,pairs:1,invert:1,pick:0,omit:0,chain:1,isEmpty:1};s(J,a,"attributes");var c=D.Collection=function(R,Q){Q||(Q={});if(Q.model){this.model=Q.model}if(Q.comparator!==void 0){this.comparator=Q.comparator}this._reset();this.initialize.apply(this,arguments);if(R){this.reset(R,P.extend({silent:true},Q))}};var o={add:true,remove:true,merge:true};var O={add:true,remove:false};var v=function(V,U,Q){Q=Math.min(Math.max(Q,0),V.length);var R=Array(V.length-Q);var T=U.length;var S;for(S=0;S<R.length;S++){R[S]=V[S+Q]}for(S=0;S<T;S++){V[S+Q]=U[S]}for(S=0;S<R.length;S++){V[S+T+Q]=R[S]}};P.extend(c.prototype,N,{model:J,initialize:function(){},toJSON:function(Q){return this.map(function(R){return R.toJSON(Q)})},sync:function(){return D.sync.apply(this,arguments)},add:function(R,Q){return this.set(R,P.extend({merge:false},Q,O))},remove:function(T,Q){Q=P.extend({},Q);var R=!P.isArray(T);T=R?[T]:T.slice();var S=this._removeModels(T,Q);if(!Q.silent&&S.length){Q.changes={added:[],merged:[],removed:S};this.trigger("update",this,Q)}return R?S[0]:S},set:function(ai,R){if(ai==null){return}R=P.extend({},o,R);if(R.parse&&!this._isModel(ai)){ai=this.parse(ai,R)||[]}var U=!P.isArray(ai);ai=U?[ai]:ai.slice();var W=R.at;if(W!=null){W=+W}if(W>this.length){W=this.length}if(W<0){W+=this.length+1}var V=[];var aj=[];var ab=[];var ac=[];var Z={};var X=R.add;var T=R.merge;var ak=R.remove;var ag=false;var Q=this.comparator&&W==null&&R.sort!==false;var af=P.isString(this.comparator)?this.comparator:null;var S,ae;
for(ae=0;ae<ai.length;ae++){S=ai[ae];var Y=this.get(S);if(Y){if(T&&S!==Y){var aa=this._isModel(S)?S.attributes:S;if(R.parse){aa=Y.parse(aa,R)}Y.set(aa,R);ab.push(Y);if(Q&&!ag){ag=Y.hasChanged(af)}}if(!Z[Y.cid]){Z[Y.cid]=true;V.push(Y)}ai[ae]=Y}else{if(X){S=ai[ae]=this._prepareModel(S,R);if(S){aj.push(S);this._addReference(S,R);Z[S.cid]=true;V.push(S)}}}}if(ak){for(ae=0;ae<this.length;ae++){S=this.models[ae];if(!Z[S.cid]){ac.push(S)}}if(ac.length){this._removeModels(ac,R)}}var ad=false;var ah=!Q&&X&&ak;if(V.length&&ah){ad=this.length!==V.length||P.some(this.models,function(al,am){return al!==V[am]});this.models.length=0;v(this.models,V,0);this.length=this.models.length}else{if(aj.length){if(Q){ag=true}v(this.models,aj,W==null?this.length:W);this.length=this.models.length}}if(ag){this.sort({silent:true})}if(!R.silent){for(ae=0;ae<aj.length;ae++){if(W!=null){R.index=W+ae}S=aj[ae];S.trigger("add",S,this,R)}if(ag||ad){this.trigger("sort",this,R)}if(aj.length||ac.length||ab.length){R.changes={added:aj,removed:ac,merged:ab};this.trigger("update",this,R)}}return U?ai[0]:ai},reset:function(S,Q){Q=Q?P.clone(Q):{};for(var R=0;R<this.models.length;R++){this._removeReference(this.models[R],Q)}Q.previousModels=this.models;this._reset();S=this.add(S,P.extend({silent:true},Q));if(!Q.silent){this.trigger("reset",this,Q)}return S},push:function(R,Q){return this.add(R,P.extend({at:this.length},Q))},pop:function(R){var Q=this.at(this.length-1);return this.remove(Q,R)},unshift:function(R,Q){return this.add(R,P.extend({at:0},Q))},shift:function(R){var Q=this.at(0);return this.remove(Q,R)},slice:function(){return n.apply(this.models,arguments)},get:function(Q){if(Q==null){return void 0}return this._byId[Q]||this._byId[this.modelId(Q.attributes||Q)]||Q.cid&&this._byId[Q.cid]},has:function(Q){return this.get(Q)!=null},at:function(Q){if(Q<0){Q+=this.length}return this.models[Q]},where:function(Q,R){return this[R?"find":"filter"](Q)},findWhere:function(Q){return this.where(Q,true)},sort:function(R){var Q=this.comparator;if(!Q){throw new Error("Cannot sort a set without a comparator")}R||(R={});var S=Q.length;if(P.isFunction(Q)){Q=P.bind(Q,this)}if(S===1||P.isString(Q)){this.models=this.sortBy(Q)}else{this.models.sort(Q)}if(!R.silent){this.trigger("sort",this,R)}return this},pluck:function(Q){return this.map(Q+"")},fetch:function(Q){Q=P.extend({parse:true},Q);var S=Q.success;var R=this;Q.success=function(T){var U=Q.reset?"reset":"set";R[U](T,Q);if(S){S.call(Q.context,R,T,Q)}R.trigger("sync",R,T,Q)};M(this,Q);return this.sync("read",this,Q)},create:function(R,Q){Q=Q?P.clone(Q):{};var S=Q.wait;R=this._prepareModel(R,Q);if(!R){return false}if(!S){this.add(R,Q)}var U=this;var T=Q.success;Q.success=function(W,X,V){if(S){U.add(W,V)}if(T){T.call(V.context,W,X,V)}};R.save(null,Q);return R},parse:function(R,Q){return R},clone:function(){return new this.constructor(this.models,{model:this.model,comparator:this.comparator})},modelId:function(Q){return Q[this.model.prototype.idAttribute||"id"]},_reset:function(){this.length=0;this.models=[];this._byId={}},_prepareModel:function(S,R){if(this._isModel(S)){if(!S.collection){S.collection=this}return S}R=R?P.clone(R):{};R.collection=this;var Q=new this.model(S,R);if(!Q.validationError){return Q}this.trigger("invalid",this,Q.validationError,R);return false},_removeModels:function(W,S){var U=[];for(var T=0;T<W.length;T++){var R=this.get(W[T]);if(!R){continue}var Q=this.indexOf(R);this.models.splice(Q,1);this.length--;delete this._byId[R.cid];var V=this.modelId(R.attributes);if(V!=null){delete this._byId[V]}if(!S.silent){S.index=Q;R.trigger("remove",R,this,S)}U.push(R);this._removeReference(R,S)}return U},_isModel:function(Q){return Q instanceof J},_addReference:function(R,Q){this._byId[R.cid]=R;var S=this.modelId(R.attributes);if(S!=null){this._byId[S]=R}R.on("all",this._onModelEvent,this)},_removeReference:function(R,Q){delete this._byId[R.cid];var S=this.modelId(R.attributes);if(S!=null){delete this._byId[S]}if(this===R.collection){delete R.collection}R.off("all",this._onModelEvent,this)},_onModelEvent:function(S,R,U,Q){if(R){if((S==="add"||S==="remove")&&U!==this){return}if(S==="destroy"){this.remove(R,Q)}if(S==="change"){var T=this.modelId(R.previousAttributes());var V=this.modelId(R.attributes);if(T!==V){if(T!=null){delete this._byId[T]}if(V!=null){this._byId[V]=R}}}}this.trigger.apply(this,arguments)}});var A={forEach:3,each:3,map:3,collect:3,reduce:0,foldl:0,inject:0,reduceRight:0,foldr:0,find:3,detect:3,filter:3,select:3,reject:3,every:3,all:3,some:3,any:3,include:3,includes:3,contains:3,invoke:0,max:3,min:3,toArray:1,size:1,first:3,head:3,take:3,initial:3,rest:3,tail:3,drop:3,last:3,without:0,difference:0,indexOf:3,shuffle:1,lastIndexOf:3,isEmpty:1,chain:1,sample:3,partition:3,groupBy:3,countBy:3,sortBy:3,indexBy:3,findIndex:3,findLastIndex:3};s(c,A,"models");var L=D.View=function(Q){this.cid=P.uniqueId("view");P.extend(this,P.pick(Q,f));this._ensureElement();this.initialize.apply(this,arguments)};var x=/^(\S+)\s*(.*)$/;var f=["model","collection","el","id","attributes","className","tagName","events"];P.extend(L.prototype,N,{tagName:"div",$:function(Q){return this.$el.find(Q)},initialize:function(){},render:function(){return this},remove:function(){this._removeElement();this.stopListening();return this},_removeElement:function(){this.$el.remove()},setElement:function(Q){this.undelegateEvents();this._setElement(Q);this.delegateEvents();return this},_setElement:function(Q){this.$el=Q instanceof D.$?Q:D.$(Q);this.el=this.$el[0]},delegateEvents:function(S){S||(S=P.result(this,"events"));if(!S){return this}this.undelegateEvents();for(var R in S){var T=S[R];if(!P.isFunction(T)){T=this[T]}if(!T){continue}var Q=R.match(x);this.delegate(Q[1],Q[2],P.bind(T,this))}return this},delegate:function(R,Q,S){this.$el.on(R+".delegateEvents"+this.cid,Q,S);return this},undelegateEvents:function(){if(this.$el){this.$el.off(".delegateEvents"+this.cid)}return this},undelegate:function(R,Q,S){this.$el.off(R+".delegateEvents"+this.cid,Q,S);return this},_createElement:function(Q){return document.createElement(Q)},_ensureElement:function(){if(!this.el){var Q=P.extend({},P.result(this,"attributes"));if(this.id){Q.id=P.result(this,"id")}if(this.className){Q["class"]=P.result(this,"className")}this.setElement(this._createElement(P.result(this,"tagName")));this._setAttributes(Q)}else{this.setElement(P.result(this,"el"))}},_setAttributes:function(Q){this.$el.attr(Q)}});D.sync=function(X,S,R){var U=k[X];P.defaults(R||(R={}),{emulateHTTP:D.emulateHTTP,emulateJSON:D.emulateJSON});var W={type:U,dataType:"json"};if(!R.url){W.url=P.result(S,"url")||t()}if(R.data==null&&S&&(X==="create"||X==="update"||X==="patch")){W.contentType="application/json";W.data=JSON.stringify(R.attrs||S.toJSON(R))}if(R.emulateJSON){W.contentType="application/x-www-form-urlencoded";W.data=W.data?{model:W.data}:{}}if(R.emulateHTTP&&(U==="PUT"||U==="DELETE"||U==="PATCH")){W.type="POST";if(R.emulateJSON){W.data._method=U}var T=R.beforeSend;R.beforeSend=function(Y){Y.setRequestHeader("X-HTTP-Method-Override",U);if(T){return T.apply(this,arguments)}}}if(W.type!=="GET"&&!R.emulateJSON){W.processData=false}var Q=R.error;R.error=function(Z,aa,Y){R.textStatus=aa;R.errorThrown=Y;if(Q){Q.call(R.context,Z,aa,Y)}};var V=R.xhr=D.ajax(P.extend(W,R));S.trigger("request",S,V,R);return V};var k={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};D.ajax=function(){return D.$.ajax.apply(D.$,arguments)};var p=D.Router=function(Q){Q||(Q={});if(Q.routes){this.routes=Q.routes}this._bindRoutes();this.initialize.apply(this,arguments)};var r=/\((.*?)\)/g;var u=/(\(\?)?:\w+/g;var e=/\*\w+/g;var i=/[\-{}\[\]+?.,\\\^$|#\s]/g;P.extend(p.prototype,N,{initialize:function(){},route:function(R,S,T){if(!P.isRegExp(R)){R=this._routeToRegExp(R)}if(P.isFunction(S)){T=S;S=""}if(!T){T=this[S]}var Q=this;D.history.route(R,function(V){var U=Q._extractParameters(R,V);if(Q.execute(T,U,S)!==false){Q.trigger.apply(Q,["route:"+S].concat(U));Q.trigger("route",S,U);D.history.trigger("route",Q,S,U)}});return this},execute:function(S,R,Q){if(S){S.apply(this,R)}},navigate:function(R,Q){D.history.navigate(R,Q);return this},_bindRoutes:function(){if(!this.routes){return}this.routes=P.result(this,"routes");var R,Q=P.keys(this.routes);while((R=Q.pop())!=null){this.route(R,this.routes[R])}},_routeToRegExp:function(Q){Q=Q.replace(i,"\\$&").replace(r,"(?:$1)?").replace(u,function(S,R){return R?S:"([^/?]+)"}).replace(e,"([^?]*?)");return new RegExp("^"+Q+"(?:\\?([\\s\\S]*))?$")},_extractParameters:function(Q,R){var S=Q.exec(R).slice(1);return P.map(S,function(U,T){if(T===S.length-1){return U||null}return U?decodeURIComponent(U):null})}});var j=D.History=function(){this.handlers=[];this.checkUrl=P.bind(this.checkUrl,this);if(typeof window!=="undefined"){this.location=window.location;this.history=window.history}};var E=/^[#\/]|\s+$/g;var g=/^\/+|\/+$/g;var K=/#.*$/;j.started=false;P.extend(j.prototype,N,{interval:50,atRoot:function(){var Q=this.location.pathname.replace(/[^\/]$/,"$&/");return Q===this.root&&!this.getSearch()},matchRoot:function(){var R=this.decodeFragment(this.location.pathname);var Q=R.slice(0,this.root.length-1)+"/";return Q===this.root},decodeFragment:function(Q){return decodeURI(Q.replace(/%25/g,"%2525"))},getSearch:function(){var Q=this.location.href.replace(/#.*/,"").match(/\?.+/);return Q?Q[0]:""},getHash:function(R){var Q=(R||this).location.href.match(/#(.*)$/);return Q?Q[1]:""},getPath:function(){var Q=this.decodeFragment(this.location.pathname+this.getSearch()).slice(this.root.length-1);return Q.charAt(0)==="/"?Q.slice(1):Q},getFragment:function(Q){if(Q==null){if(this._usePushState||!this._wantsHashChange){Q=this.getPath()}else{Q=this.getHash()}}return Q.replace(E,"")},start:function(R){if(j.started){throw new Error("Backbone.history has already been started")}j.started=true;this.options=P.extend({root:"/"},this.options,R);this.root=this.options.root;this._wantsHashChange=this.options.hashChange!==false;
this._hasHashChange="onhashchange" in window&&(document.documentMode===void 0||document.documentMode>7);this._useHashChange=this._wantsHashChange&&this._hasHashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!!(this.history&&this.history.pushState);this._usePushState=this._wantsPushState&&this._hasPushState;this.fragment=this.getFragment();this.root=("/"+this.root+"/").replace(g,"/");if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!this.atRoot()){var T=this.root.slice(0,-1)||"/";this.location.replace(T+"#"+this.getPath());return true}else{if(this._hasPushState&&this.atRoot()){this.navigate(this.getHash(),{replace:true})}}}if(!this._hasHashChange&&this._wantsHashChange&&!this._usePushState){this.iframe=document.createElement("iframe");this.iframe.src="javascript:0";this.iframe.style.display="none";this.iframe.tabIndex=-1;var Q=document.body;var S=Q.insertBefore(this.iframe,Q.firstChild).contentWindow;S.document.open();S.document.close();S.location.hash="#"+this.fragment}var U=window.addEventListener||function(V,W){return attachEvent("on"+V,W)};if(this._usePushState){U("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){U("hashchange",this.checkUrl,false)}else{if(this._wantsHashChange){this._checkUrlInterval=setInterval(this.checkUrl,this.interval)}}}if(!this.options.silent){return this.loadUrl()}},stop:function(){var Q=window.removeEventListener||function(R,S){return detachEvent("on"+R,S)};if(this._usePushState){Q("popstate",this.checkUrl,false)}else{if(this._useHashChange&&!this.iframe){Q("hashchange",this.checkUrl,false)}}if(this.iframe){document.body.removeChild(this.iframe);this.iframe=null}if(this._checkUrlInterval){clearInterval(this._checkUrlInterval)}j.started=false},route:function(Q,R){this.handlers.unshift({route:Q,callback:R})},checkUrl:function(R){var Q=this.getFragment();if(Q===this.fragment&&this.iframe){Q=this.getHash(this.iframe.contentWindow)}if(Q===this.fragment){return false}if(this.iframe){this.navigate(Q)}this.loadUrl()},loadUrl:function(Q){if(!this.matchRoot()){return false}Q=this.fragment=this.getFragment(Q);return P.some(this.handlers,function(R){if(R.route.test(Q)){R.callback(Q);return true}})},navigate:function(S,R){if(!j.started){return false}if(!R||R===true){R={trigger:!!R}}S=this.getFragment(S||"");var U=this.root;if(S===""||S.charAt(0)==="?"){U=U.slice(0,-1)||"/"}var Q=U+S;S=this.decodeFragment(S.replace(K,""));if(this.fragment===S){return}this.fragment=S;if(this._usePushState){this.history[R.replace?"replaceState":"pushState"]({},document.title,Q)}else{if(this._wantsHashChange){this._updateHash(this.location,S,R.replace);if(this.iframe&&S!==this.getHash(this.iframe.contentWindow)){var T=this.iframe.contentWindow;if(!R.replace){T.document.open();T.document.close()}this._updateHash(T.location,S,R.replace)}}else{return this.location.assign(Q)}}if(R.trigger){return this.loadUrl(S)}},_updateHash:function(Q,S,T){if(T){var R=Q.href.replace(/(javascript:|#).*$/,"");Q.replace(R+"#"+S)}else{Q.hash="#"+S}}});D.history=new j;var l=function(Q,S){var R=this;var T;if(Q&&P.has(Q,"constructor")){T=Q.constructor}else{T=function(){return R.apply(this,arguments)}}P.extend(T,R,S);T.prototype=P.create(R.prototype,Q);T.prototype.constructor=T;T.__super__=R.prototype;return T};J.extend=c.extend=p.extend=L.extend=j.extend=l;var t=function(){throw new Error('A "url" property or function must be specified')};var M=function(S,R){var Q=R.error;R.error=function(T){if(Q){Q.call(R.context,S,T,R)}S.trigger("error",S,T,R)}};return D});